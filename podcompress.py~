from urllib.request import urlopen
import feedparser
import os
import subprocess

names = []
links = []

podcast_file = open("podcast_list.txt")

for line in podcast_file:
	names.append(line.split(",")[0])
	links.append(line.split(",")[1].replace(" ", ""))

x = 0
for name in names:
	x = x + 1
	print(str(x) + ". " + name)
	

podcast_number = int(input("Which podcast? (1 - " + str(len(links)) + ") "))
if podcast_number <= len(links):
	print("Reading from: " + links[podcast_number-1])
	podcast = feedparser.parse(links[podcast_number-1])

title = podcast.feed.title
description = podcast.feed.description
latest_podcast = podcast.entries[0]

directory = "./" + title
if not os.path.exists(directory):
	os.makedirs(directory)

#print()
#print("Title: " + title)
#print("Description: " + description)

for entry in podcast.entries:
	print()
	print("\tPodcast: " + entry.title)
	print("\tDate: " + entry.published)
	print("\tLink: " + entry.enclosures[0].url)
	print()

	file_path = "./" + title + "/" + entry.title + ".mp3"
	compressed_file_path = "./" + title + "/" + entry.title + "_compressed.mp3"
	
	print("\t\tDownloading...")
	f = urlopen(entry.enclosures[0].url)
	data = f.read()
	with open("./" + title + "/" + entry.title + ".mp3", "wb") as code:
		code.write(data)
	
	print("\t\tCompressing...")
	subprocess.call(["lame","-S","--nohist","-b","32",file_path,compressed_file_path])
	
	subprocess.call(["rm",file_path])
	print("\t\tDone!")
